<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆì¸  ìë™í™” í”„ë¡œê·¸ë¨ - UI</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #d3d9e2 0%, #a8b4c2 100%);
            --panel-bg: rgba(255, 255, 255, 0.95);
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --border-color: #e2e8f0;
            --accent-color: #667eea;
            --accent-hover: #5a67d8;
            --card-bg: rgb(225, 231, 235);
            --card-border: #e2e8f0;
            --download-bg: #28a745;
            --download-hover-bg: #218838;
            --upload-bg: #f8f9ff;
            --upload-border: #667eea;
            --upload-hover-bg: #f0f2ff;
            --upload-hover-border: #764ba2;
            --btn-disabled-bg: #ccc;
            --success-bg: #d4edda;
            --success-text: #155724;
            --success-border: #2f4434;
            --error-bg: #bfc9c7;
            --error-text: #721c24;
            --error-border: #cfe3e3;
            --input-bg: rgb(209, 225, 224);
            --input-border: #ddd;
        }

        body.dark-mode {
            --bg-gradient: linear-gradient(135deg, #08282f 0%, #1a2a2f 100%);
            --panel-bg: rgba(30, 45, 50, 0.95);
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --border-color: #405560;
            --accent-color: #00897b;
            --accent-hover: #00695c;
            --card-bg: #2c3e50;
            --card-border: #405560;
            --download-bg: #388e3c;
            --download-hover-bg: #2e7d32;
            --upload-bg: #2a3f34;
            --upload-border: #26a69a;
            --upload-hover-bg: #37454f;
            --btn-disabled-bg: #555;
            --success-bg: #2e7d32;
            --success-text: #e0e0e0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            padding: 1rem;
            color: var(--text-primary);
            transition: background 0.3s ease;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 7fr 3fr; /* 7:3 ë¹„ìœ¨ë¡œ ì¡°ì • */
            gap: 2rem;
        }

        .left-panel, .right-panel {
            background: var(--panel-bg);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .resizer {
            background-color: rgba(0,0,0,0.1);
            cursor: col-resize;
            width: 10px;
            border-radius: 5px;
            transition: background-color 0.2s;
        }

        .resizer:hover, .resizer.active {
            background-color: #667eea;
        }

        .header {
            text-align: center;
            margin-bottom: 0.5rem;
            position: relative;
        }

        .title-box {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 0.8rem 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        body.dark-mode .title-box {
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .header .title-box {
            display: inline-block;
            text-align: center;
            padding: 0.8rem 1.5rem;
        }
        
        .left-panel .title-box,
        .right-panel .title-box {
            margin-bottom: 1.5rem;
        }

        .right-panel .title-box {
            align-self: center;
        }

        .title-box > * {
            margin: 0;
            padding: 0;
        }

        .title-box h1 {
            font-size: 1.5rem;
            margin: 0;
        }
        
        .title-box p {
            color: var(--text-secondary);
        }

        #theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: none;
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        #theme-toggle:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
            transform: rotate(15deg);
        }

        .upload-section {
            background: #000;
            border: none;
            aspect-ratio: 16 / 9;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-section:hover {
            transform: scale(1.01);
            background: #111;
        }

        .upload-section.dragover {
            background: #222;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            color: white;
            margin-bottom: 1rem;
        }

        .upload-section h3 {
            color: white;
        }
        
        .upload-section p {
            color: #ccc;
        }

        .file-input {
            display: none;
        }

        .file-info {
            background: var(--success-bg);
            color: var(--success-text);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
            display: none;
        }

        .options-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .option-group {
            background: var(--upload-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .option-group:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.08);
        }

        .option-group h3 {
            color: var(--text-primary);
            margin-top: 0;
            margin-bottom: 1.2rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--accent-color);
        }

        .platform-selection {
            /* Override theme variables for this section to mimic dark mode */
            --card-bg: #2c3e50;
            --card-border: #405560;
            --text-primary: #e0e0e0;
            --accent-color: #00897b;

            background: #2a3f34;
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .platform-selection h3 {
            color: var(--text-primary);
            margin-top: 0;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .platform-grid {
            display: flex;
            align-items: stretch;
            justify-content: space-between;
            flex-wrap: nowrap;
            gap: 1.5rem;
            width: 100%;
        }

        .platform-group {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap; /* ì°½ í¬ê¸°ê°€ ì¤„ì–´ë“¤ë©´ ì¤„ë°”ê¿ˆ ë˜ë„ë¡ */
            align-items: center;
        }

        .llm-group {
            padding-left: 1.5rem;
            border-left: 1px solid var(--card-border);
        }

        .llm-card {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .llm-card:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .llm-card.selected {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .platform-empty-space {
            display: none; /* ì´ì œ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ */
        }

        .platform-card {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 10px;
            padding: 0.75rem 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            max-width: 120px;
            font-size: 0.8rem;
            color: var(--text-primary); /* Use variable for text color */
        }

        .platform-card:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .platform-card.selected {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .platform-icon {
            font-size: 1.8rem;
            margin-bottom: 0.25rem;
        }

        .process-section {
            text-align: center;
        }

        .process-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 1rem 3rem;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .process-btn:hover {
            transform: translateY(-3px);
            background: var(--accent-hover);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
        }

        .process-btn:disabled {
            background: var(--btn-disabled-bg);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .progress-section {
            margin-top: 2rem;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--border-color);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .status-text {
            text-align: center;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* ì˜¤ë¥¸ìª½ íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .video-preview-section {
            margin-bottom: 2rem;
            display: none; /* Hidden by default */
        }

        .video-preview-section h3 {
            color: var(--text-primary);
            margin-bottom: 1.5rem; /* More space */
            text-align: center;
        }

        .video-container {
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 1rem;
            position: relative;
            width: 100%;
            height: 400px; /* Set a fixed height for the container */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-container video {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Show the entire video without cropping */
        }

        .video-placeholder {
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
            font-size: 1.2rem;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 1rem;
            aspect-ratio: 9 / 16;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .control-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .control-btn:hover {
            background: var(--accent-hover);
        }

        .control-btn:disabled {
            background: var(--btn-disabled-bg);
            cursor: not-allowed;
        }

        .results-section {
            display: block;
        }

        .results-section h3 {
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .result-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            aspect-ratio: 9 / 16;
            max-width: 240px;
            width: 100%;
            background: var(--upload-bg);
            border: 2px dashed var(--border-color);
            border-radius: 15px;
            color: var(--text-secondary);
            text-align: center;
            padding: 1rem;
            margin: 0 auto;
        }

        .result-video-grid {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .result-video-item {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .result-video-item h4 {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .result-video-container {
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 1rem;
            aspect-ratio: 9 / 16;
            max-width: 240px; /* Set max-width as requested */
            margin-left: auto;
            margin-right: auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result-video-container video {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Fill the container for 9:16 shorts */
        }

        .result-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }

        .download-btn {
            background: var(--download-bg);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .download-btn:hover {
            background: var(--download-hover-bg);
        }

        .upload-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .upload-btn:hover {
            background: var(--accent-hover);
        }

        .upload-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .upload-modal.active {
            display: flex;
        }

        .upload-modal-content {
            background: var(--panel-bg);
            border-radius: 15px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
        }

        .upload-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group textarea {
            padding: 0.5rem;
            border: 1px solid var(--input-border);
            border-radius: 5px;
            font-size: 1rem;
            background-color: var(--input-bg);
            color: var(--text-primary);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1rem;
        }

        .modal-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }

        .modal-btn.cancel {
            background: #6c757d;
            color: white;
        }

        .modal-btn.upload {
            background: var(--accent-color);
            color: white;
        }

        .status-message {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 5px;
            text-align: center;
            font-weight: 600;
        }

        .status-message.success {
            background: var(--success-bg);
            color: var(--success-text);
            border: 1px solid var(--success-border);
        }

        .status-message.error {
            background: var(--error-bg);
            color: var(--error-text);
            border: 1px solid var(--error-border);
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto;
            }
            
            .right-panel {
                order: -1;
            }
        }

        main {
            display: flex;
            flex: 1;
            min-height: 0;
            margin-top: 10px;
        }

        #video-display-section {
            width: 50%; /* ì´ˆê¸° ë„ˆë¹„ */
            min-width: 300px;
            display: flex;
            flex-direction: column;
            padding-right: 5px;
            /* border-right ì†ì„± ì œê±° */
        }

        #resizer {
            width: 5px;
            cursor: col-resize;
            background-color: var(--border-color);
            flex-shrink: 0;
            transition: background-color 0.2s;
        }
        #resizer:hover {
            background-color: var(--accent-color);
        }

        #video-work-section {
            flex-grow: 1; /* ë‚¨ì€ ê³µê°„ì„ ëª¨ë‘ ì°¨ì§€ */
            min-width: 300px;
            display: flex;
            flex-direction: column;
            padding-left: 5px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .setting-item:first-of-type {
            margin-top: 0.5rem;
        }

        .setting-item label {
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .setting-input {
            width: 80px;
            padding: 0.5rem;
            border-radius: 5px;
            border: 1px solid var(--input-border);
            text-align: center;
            background-color: var(--input-bg);
            color: var(--text-primary);
        }

        #videoEditorContainer {
            width: 100%;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 2rem;
            /* aspect-ratio ì œê±° */
        }

        #videoPreview {
            width: 100%;
            height: auto;
            max-height: 500px; /* ë¹„ë””ì˜¤ ìµœëŒ€ ë†’ì´ ì œí•œ ì¶”ê°€ */
            display: block; /* ìˆ˜ì§ ì •ë ¬ ë¬¸ì œ ë°©ì§€ */
        }

        .short-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.08);
        }

        .short-item .video-container {
            position: relative;
            cursor: pointer;
            aspect-ratio: 9 / 16;
            background-color: #000;
            max-width: 288px;
            margin: 0 auto;
        }

        .short-item video {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
        }

        .short-item .video-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            color: rgba(255, 255, 255, 0.7);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .short-item .video-container:hover .video-overlay {
            opacity: 1;
        }

        .short-info {
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--upload-bg);
        }

        #completedShortsGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(292px, 1fr));
            gap: 1.5rem;
            align-items: start;
            justify-items: center;
        }

        .selection-container {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2rem;
            align-items: stretch;
        }

        .dark-selection-box {
            --card-bg: #2c3e50;
            --card-border: #405560;
            --text-primary: #e0e0e0;
            --accent-color: #00897b;
            background: #2a3f34;
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
        }

        .selection-container .dark-selection-box:first-child {
            flex: 6;
        }
        
        .selection-container .dark-selection-box:last-child {
            flex: 4;
        }

        .dark-selection-box h3 {
            color: var(--text-primary);
            margin-top: 0;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .short-item {
            border: 1px solid var(--card-border);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            max-width: 292px;
        }

        .short-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.08);
        }

        .short-item .video-container {
            position: relative;
            cursor: pointer;
            aspect-ratio: 9 / 16;
            background-color: #000;
            max-width: 288px;
            margin: 0 auto;
        }

        .short-item video {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
        }
        
        .short-item .video-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            color: rgba(255, 255, 255, 0.7);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .short-item .video-container:hover .video-overlay {
            opacity: 1;
        }

        .short-info {
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--upload-bg);
        }

        /* --- Right Panel Chat Styles --- */
        .chat-panel {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            overflow: hidden; /* ìì‹ ìš”ì†Œê°€ ë¶€ëª¨ë¥¼ ë„˜ì§€ ì•Šë„ë¡ */
            min-height: 0; /* flex-growê°€ ì œëŒ€ë¡œ ì‘ë™í•˜ê¸° ìœ„í•´ í•„ìš” */
        }

        .chat-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h3 {
            margin: 0;
            font-size: 1.2rem;
            color: var(--text-primary);
        }

        #newChatBtn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #newChatBtn:hover {
            background-color: var(--accent-hover);
        }

        .chat-history {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chat-message {
            display: flex;
            gap: 0.75rem;
            max-width: 85%;
        }

        .chat-message .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .chat-message .message-content {
            background-color: var(--upload-bg);
            padding: 0.75rem 1rem;
            border-radius: 15px;
            color: var(--text-secondary);
        }
        
        .chat-message .message-content p {
            margin: 0;
            line-height: 1.5;
        }

        .user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .user-message .message-content {
            background-color: var(--accent-color);
            color: white;
        }

        .ai-message {
            align-self: flex-start;
        }

        .chat-input-area {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 1rem;
        }

        #chatInput {
            flex-grow: 1;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg);
            color: var(--text-primary);
            resize: none;
            font-family: inherit;
            font-size: 1rem;
        }

        #chatInput:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        #sendChatBtn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 0 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
        }
        
        #sendChatBtn:disabled {
             background: var(--btn-disabled-bg);
             cursor: not-allowed;
        }

        .right-panel {
            display: flex;
            flex-direction: column;
            height: 100%;
            gap: 2rem; /* ì„¹ì…˜ ì‚¬ì´ ê°„ê²© */
        }

        #resultsContainer {
            flex-shrink: 0;
        }

        .selection-container {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2rem;
            align-items: stretch;
        }

        .dark-selection-box {
            --card-bg: #2c3e50;
            --card-border: #405560;
            --text-primary: #e0e0e0;
            --accent-color: #00897b;
            background: #2a3f34;
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
        }

        .dark-selection-box h3 {
            color: var(--text-primary);
            margin-top: 0;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        #completedShortsGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(292px, 1fr));
            gap: 1.5rem;
            align-items: start;
            justify-items: center;
        }

        .ai-model-box {
            justify-content: space-between;
        }
        .ai-model-box .chat-input-area {
            padding: 0;
            border-top: none;
            margin-bottom: 1.5rem;
            display: flex;
            gap: 0.75rem;
        }
        .ai-model-box #chatInput {
            background-color: #ffffff; /* í°ìƒ‰ ë°°ê²½ */
            color: #000000; /* ê²€ì€ìƒ‰ í°íŠ¸ */
            border: 1px solid #d1d5db; /* ë°ì€ íšŒìƒ‰ í…Œë‘ë¦¬ */
        }
        .ai-model-box #chatInput::placeholder {
            color: #6b7280; /* ì–´ë‘ìš´ íšŒìƒ‰ placeholder */
        }
        .ai-model-box #chatInput:focus {
            border-color: var(--accent-color);
        }
        .ai-model-box #sendChatBtn {
            background-color: var(--accent-color);
            color: white;
            font-weight: normal;
        }

        .ai-model-box .ai-model-container {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            width: 90%;
            margin: 0 auto;
        }
        
        .ai-model-container .setting-input {
            color: #1a202c; /* ê²€ì€ìƒ‰ í…ìŠ¤íŠ¸ */
            background-color: #ffffff; /* í°ìƒ‰ ë°°ê²½ */
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            padding: 0.65rem;
            font-size: 0.9rem;
            flex-grow: 1;
        }

        .ai-model-container .setting-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(0, 137, 123, 0.2);
        }

        .ai-model-container .settings-btn {
            background: none;
            border: 1px solid var(--card-border);
            color: var(--text-primary);
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            line-height: 1;
            transition: all 0.2s;
        }

        .ai-model-container .settings-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-color);
        }

        /* --- API Key Modal Styles --- */
        .api-key-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            animation: fadeIn 0.3s;
        }

        .api-key-modal .modal-content {
            background-color: #fefefe;
            color: #1a202c;
            margin: 15% auto;
            padding: 2rem;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: slideIn 0.3s;
        }

        .api-key-modal .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .api-key-modal .close-button:hover,
        .api-key-modal .close-button:focus {
            color: black;
            text-decoration: none;
        }

        .api-key-modal h3 {
            margin-top: 0;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .api-key-modal .form-group {
            margin-bottom: 1.5rem;
        }
        
        .api-key-modal .form-label-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .api-key-modal .form-label-group label {
            font-size: 1rem;
            font-weight: 600;
        }

        .api-key-modal #apiKeyLink {
            font-size: 0.85rem;
            color: #007bff;
            text-decoration: none;
        }

        .api-key-modal #apiKeyLink:hover {
            text-decoration: underline;
        }

        .api-key-modal .form-group-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        .api-key-modal .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .api-key-modal .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .api-key-modal .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .api-key-modal .btn-secondary:hover {
            background-color: #5a6268;
        }

        .api-key-modal .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .api-key-modal .btn-primary:hover {
            background-color: #0056b3;
        }

        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }

        @keyframes slideIn {
            from {transform: translateY(-50px);}
            to {transform: translateY(0);}
        }
    </style>
</head>
<body>
    <div class="main-layout">
        <!-- ì™¼ìª½ íŒ¨ë„: ì„¤ì • ë° ì»¨íŠ¸ë¡¤ -->
        <div class="left-panel">
            <div class="header">
                <div class="title-box">
                    <h1>ğŸ¬ ìˆì¸  ìë™í™” í”„ë¡œê·¸ë¨</h1>
                    
                </div>
                <button id="theme-toggle">ğŸŒ™</button>
            </div>

            <!-- íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ -->
            <div class="upload-section" id="uploadContainer">
                <div class="upload-icon">ğŸ“</div>
                <h3>ì˜ìƒ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</h3>
                <p>MP4, AVI, MOV íŒŒì¼ ì§€ì›</p>
                <input type="file" id="file-input" class="file-input" accept="video/*">
                <div class="file-info" id="fileInfo">
                    <p id="fileName"></p>
                    <p id="fileSize"></p>
                </div>
            </div>

            <!-- ì›ë³¸ ì˜ìƒ ë¯¸ë¦¬ë³´ê¸° (ì—…ë¡œë“œ í›„ í‘œì‹œ) -->
            <div class="video-preview-section" id="videoPreviewSection">
                <h3>ğŸ“¹&nbsp;ì›ë³¸ ì˜ìƒ ë¯¸ë¦¬ë³´ê¸°</h3>
                <div class="video-container" id="originalVideoContainer">
                    <div class="video-placeholder">
                        ì˜ìƒì„ ì—…ë¡œë“œí•˜ë©´ ì—¬ê¸°ì—ì„œ ë¯¸ë¦¬ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤
                    </div>
                </div>
                <div class="video-controls">
                    <button class="control-btn" id="playBtn" disabled>â–¶ï¸ ì¬ìƒ</button>
                    <button class="control-btn" id="pauseBtn" disabled>â¸ï¸ ì¼ì‹œì •ì§€</button>
                    <button class="control-btn" id="rewindBtn" disabled>âª ë˜ê°ê¸°</button>
                </div>
            </div>
            
            <!-- ì²˜ë¦¬ ì˜µì…˜ ì„¹ì…˜ -->
            <div id="videoEditorContainer" style="display: none;">
                <video id="videoPreview" controls></video>
            </div>

            <div class="options-section">
                <div class="option-group">
                    <h3>ğŸ“¼ ì˜ìƒ ì²˜ë¦¬</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="autoHighlight" name="video_processing" value="highlight" checked>
                            <label for="autoHighlight">ìë™ í•˜ì´ë¼ì´íŠ¸ ì¶”ì¶œ</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="autoCrop" name="video_processing" value="crop" checked>
                            <label for="autoCrop">ìë™ í¬ë¡­</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="colorCorrection" name="video_processing" value="color" checked>
                            <label for="colorCorrection">ìƒ‰ìƒ ë³´ì •</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="videoStabilization" name="video_processing" value="stabilize">
                            <label for="videoStabilization">ì˜ìƒ ì•ˆì •í™”</label>
                        </div>
                    </div>
                </div>

                <div class="option-group">
                    <h3>ğŸ”Š ì˜¤ë””ì˜¤ ì²˜ë¦¬</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="removeSilence" name="audio_processing" value="silence" checked>
                            <label for="removeSilence">ë¬´ìŒ êµ¬ê°„ ì œê±°</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="enhanceAudio" name="audio_processing" value="enhance" checked>
                            <label for="enhanceAudio">ì˜¤ë””ì˜¤ í–¥ìƒ</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="noiseReduction" name="audio_processing" value="noise" checked>
                            <label for="noiseReduction">ë…¸ì´ì¦ˆ ê°ì†Œ</label>
                        </div>
                    </div>
                </div>

                <div class="option-group">
                    <h3>ğŸ“&nbsp;ì¶”ê°€ ê¸°ëŠ¥</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="addTitle" name="features" value="title">
                            <label for="addTitle">íƒ€ì´í‹€ ì¶”ê°€</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="addSubtitles" name="features" value="subtitles">
                            <label for="addSubtitles">ìë§‰ ì¶”ê°€</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="addEffects" name="features" value="effects">
                            <label for="addEffects">ì˜ìƒíš¨ê³¼ ì¶”ê°€</label>
                        </div>
                    </div>
                </div>

                <div class="option-group">
                    <h3>âš™ï¸&nbsp;ìˆì¸  ìƒì„± ì„¤ì •</h3>
                    <div class="setting-item">
                        <label for="shortsLength">ì˜ìƒ ê¸¸ì´</label>
                        <select id="shortsLength" class="setting-input">
                            <option value="15">15ì´ˆ</option>
                            <option value="30">30ì´ˆ</option>
                            <option value="45">45ì´ˆ</option>
                            <option value="60" selected>60ì´ˆ</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="shortsCount">ìƒì„± ê°œìˆ˜</label>
                        <input type="number" id="shortsCount" class="setting-input" value="1" min="1" max="10">
                    </div>
                </div>
            </div>

            <div class="selection-container">
                <div class="dark-selection-box">
                    <h3>ğŸŒ&nbsp;í”Œë«í¼ ì„ íƒ</h3>
                    <div class="platform-group">
                        <div class="platform-card" data-platform="youtube_shorts">
                            <div class="platform-icon">ğŸ“º</div>
                            YouTube Shorts
                        </div>
                        <div class="platform-card" data-platform="instagram_reels">
                            <div class="platform-icon">ğŸ“¸</div>
                            Instagram Reels
                        </div>
                        <div class="platform-card" data-platform="tiktok">
                            <div class="platform-icon">ğŸµ</div>
                            TikTok
                        </div>
                        <div class="platform-card" data-platform="naver">
                            <div class="platform-icon">KR</div>
                            ë„¤ì´ë²„
                        </div>
                        <div class="platform-card" data-platform="facebook_reels">
                            <div class="platform-icon">ğŸ‘¥</div>
                            Facebook Reels
                        </div>
                    </div>
                </div>
    
                <div class="dark-selection-box ai-model-box">
                    <div class="chat-input-area">
                        <textarea id="chatInput" placeholder="AIì—ê²Œ ì˜ìƒ ì²˜ë¦¬ë¥¼ ìš”ì²­í•˜ì„¸ìš”..." rows="1"></textarea>
                        <button id="sendChatBtn" disabled>ì „ì†¡</button>
                    </div>
                    <div class="ai-model-container">
                        <select id="mainModelSelect" class="setting-input"></select>
                        <select id="subModelSelect" class="setting-input"></select>
                        <button class="settings-btn" id="apiSettingsBtn" title="API í‚¤ ì„¤ì •">âš™ï¸</button>
                    </div>
                </div>
            </div>

            <div class="process-section">
                <button id="processBtn" class="process-btn" disabled>ğŸš€&nbsp;ì˜ìƒ ì²˜ë¦¬ ì‹œì‘</button>
            </div>

            <!-- ì§„í–‰ë¥  í‘œì‹œ -->
            <div class="progress-section" id="progressSection">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="status-text" id="statusText">ì²˜ë¦¬ ì¤‘...</div>
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½ íŒ¨ë„: ê²°ê³¼ ë° AI ëŒ€í™” -->
        <div class="right-panel">
            <div id="resultsContainer">
                <div class="title-box">
                    <h3>âœ… ì™„ì„±ëœ ìˆì¸  ì˜ìƒ</h3>
                </div>
                <div id="completedShortsGrid">
                    <div class="short-item">
                        <div class="video-container">
                             <!-- This is the black, rounded placeholder for the video -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="chat-panel">
                <div class="chat-header">
                    <h3>AI ì–´ì‹œìŠ¤í„´íŠ¸</h3>
                    <button id="newChatBtn">ìƒˆ ëŒ€í™”</button>
                </div>
                <div class="chat-history" id="chatHistory">
                    <!-- Chat messages will be appended here -->
                </div>
            </div>
        </div>
    </div>

    <!-- ì—…ë¡œë“œ ëª¨ë‹¬ -->
    <div class="upload-modal" id="uploadModal">
        <div class="upload-modal-content">
            <h3 id="modalTitle">í”Œë«í¼ ì—…ë¡œë“œ</h3>
            <form class="upload-form" id="uploadForm">
                <div class="form-group">
                    <label for="videoTitle">ì œëª©</label>
                    <input type="text" id="videoTitle" required>
                </div>
                <div class="form-group">
                    <label for="videoDescription">ì„¤ëª…</label>
                    <textarea id="videoDescription" placeholder="ì˜ìƒì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                </div>
                <div class="form-group">
                    <label for="videoTags">íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                    <input type="text" id="videoTags" placeholder="ì˜ˆ: ìˆì¸ , ìœ íŠœë¸Œ, ì¬ë¯¸ìˆëŠ”">
                </div>
            </form>
            <div class="modal-actions">
                <button class="modal-btn cancel" id="cancelUpload">ì·¨ì†Œ</button>
                <button class="modal-btn upload" id="confirmUpload">ì—…ë¡œë“œ</button>
            </div>
        </div>
    </div>

    <!-- API Key Modal -->
    <div id="apiKeyModal" class="api-key-modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 id="apiKeyModalTitle">API í‚¤ ì„¤ì •</h3>
            <div class="form-group">
                <div class="form-label-group">
                    <label for="apiKeyInput">API í‚¤</label>
                    <a href="#" id="apiKeyLink" target="_blank" rel="noopener noreferrer">API í‚¤ ë°œê¸‰ë°›ê¸° &nearr;</a>
                </div>
                <input type="password" id="apiKeyInput" class="form-group-input">
            </div>
            <div class="modal-actions">
                <button id="cancelApiKey" class="btn btn-secondary">ì·¨ì†Œ</button>
                <button id="saveApiKey" class="btn btn-primary">ì €ì¥</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const themeToggle = document.getElementById('theme-toggle');
            
            // Upload related
            const uploadContainer = document.getElementById('uploadContainer');
            const fileInput = document.getElementById('file-input');

            // Video Preview related
            const videoEditorContainer = document.getElementById('videoEditorContainer');
            const videoPreview = document.getElementById('videoPreview');
            
            // Controls and buttons
            const processBtn = document.getElementById('processBtn');
            const platformCards = document.querySelectorAll('.platform-card');
            
            // Results related
            const resultsContainer = document.getElementById('resultsContainer');
            const completedShortsGrid = document.getElementById('completedShortsGrid');

            // Chat panel elements
            const chatHistory = document.getElementById('chatHistory');
            const chatInput = document.getElementById('chatInput');
            const sendChatBtn = document.getElementById('sendChatBtn');
            const newChatBtn = document.getElementById('newChatBtn');

            let uploadedFile = null;
            let chats = [];
            let currentChatId = null;

            // --- AI Model Data & Logic ---
            const aiModels = {
                claude: { name: "Claude", subModels: ["Claude 3 Opus", "Claude 3 Sonnet", "Claude 3 Haiku"], apiKey: "", apiKeyUrl: "https://console.anthropic.com/settings/keys" },
                gpt: { name: "GPT", subModels: ["GPT-4 Turbo", "GPT-4", "GPT-3.5 Turbo"], apiKey: "", apiKeyUrl: "https://platform.openai.com/api-keys" },
                gemini: { name: "Gemini", subModels: ["Gemini 1.5 Pro", "Gemini 1.0 Pro"], apiKey: "", apiKeyUrl: "https://aistudio.google.com/app/api-keys" },
                llama: { name: "Llama", subModels: ["Llama 3 70B", "Llama 3 8B", "Llama 2 70B"], apiKey: "", apiKeyUrl: "https://console.groq.com/keys" }
            };

            const mainModelSelect = document.getElementById('mainModelSelect');
            const subModelSelect = document.getElementById('subModelSelect');
            const apiSettingsBtn = document.getElementById('apiSettingsBtn');
            
            // API Key Modal Elements
            const apiKeyModal = document.getElementById('apiKeyModal');
            const apiKeyModalTitle = document.getElementById('apiKeyModalTitle');
            const apiKeyInput = document.getElementById('apiKeyInput');
            const apiKeyLink = document.getElementById('apiKeyLink');
            const saveApiKeyBtn = document.getElementById('saveApiKey');
            const cancelApiKeyBtn = document.getElementById('cancelApiKey');
            const closeBtn = apiKeyModal.querySelector('.close-button');
            let currentEditingModel = null;

            function initializeMainModels() {
                mainModelSelect.innerHTML = '';
                for (const key in aiModels) {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = aiModels[key].name;
                    mainModelSelect.appendChild(option);
                }
            }

            function updateSubModels() {
                const selectedModelKey = mainModelSelect.value;
                const subModels = aiModels[selectedModelKey].subModels;
                
                subModelSelect.innerHTML = '';
                subModels.forEach(modelName => {
                    const option = document.createElement('option');
                    option.value = modelName;
                    option.textContent = modelName;
                    subModelSelect.appendChild(option);
                });
            }
            
            mainModelSelect.addEventListener('change', updateSubModels);

            // --- API Key Modal Logic ---
            apiSettingsBtn.addEventListener('click', () => {
                const selectedModelKey = mainModelSelect.value;
                const modelData = aiModels[selectedModelKey];
                
                apiKeyModalTitle.textContent = `${modelData.name} API í‚¤ ì„¤ì •`;
                apiKeyInput.value = modelData.apiKey || '';
                apiKeyLink.href = modelData.apiKeyUrl;

                apiKeyModal.style.display = 'block';
                
                currentEditingModel = selectedModelKey;
            });

            function closeApiKeyModal() {
                 apiKeyModal.style.display = 'none';
            }

            closeBtn.addEventListener('click', closeApiKeyModal);
            cancelApiKeyBtn.addEventListener('click', closeApiKeyModal);
            
            saveApiKeyBtn.addEventListener('click', () => {
                if (currentEditingModel) {
                    aiModels[currentEditingModel].apiKey = apiKeyInput.value;
                    console.log(`${aiModels[currentEditingModel].name} API Key saved.`); // For debugging
                    alert(`${aiModels[currentEditingModel].name} API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    closeApiKeyModal();
                }
            });

            // --- Theme Switching ---
            function applyInitialTheme() {
                const savedTheme = localStorage.getItem('theme') || 'light';
                document.body.classList.toggle('dark-mode', savedTheme === 'dark');
                themeToggle.textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            }

            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                const isDarkMode = document.body.classList.contains('dark-mode');
                localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                themeToggle.textContent = isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™';
            });

            applyInitialTheme();

            // --- File Upload Logic ---
            function handleFile(file) {
                if (!file || !file.type.startsWith('video/')) {
                    alert('ìœ íš¨í•œ ë¹„ë””ì˜¤ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                uploadedFile = file;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    videoPreview.src = e.target.result;
                    videoPreview.load();
                };
                reader.readAsDataURL(file);

                uploadContainer.style.display = 'none';
                videoEditorContainer.style.display = 'block';
                updateProcessButtonState();
            }
            
            uploadContainer.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) handleFile(e.target.files[0]);
            });

            uploadContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadContainer.classList.add('dragover');
            });
            uploadContainer.addEventListener('dragleave', () => {
                uploadContainer.classList.remove('dragover');
            });
            uploadContainer.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadContainer.classList.remove('dragover');
                if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
            });

            // --- Platform Selection ---
            platformCards.forEach(card => {
                card.addEventListener('click', () => {
                    card.classList.toggle('selected');
                    updateProcessButtonState();
                });
            });

            function getSelectedPlatforms() {
                return document.querySelectorAll('.platform-card.selected');
            }

            // --- Process Button State ---
            function updateProcessButtonState() {
                const platformsSelected = getSelectedPlatforms().length > 0;
                processBtn.disabled = !uploadedFile || !platformsSelected;
                sendChatBtn.disabled = chatInput.value.trim() === '';
            }

            // --- Chat Panel Logic ---
            function renderChatHistory() {
                chatHistory.innerHTML = '';
                const currentChat = chats.find(chat => chat.id === currentChatId);
                if (!currentChat) return;

                currentChat.messages.forEach(msg => {
                    const messageElement = document.createElement('div');
                    messageElement.classList.add('chat-message', `${msg.sender}-message`);

                    const avatar = `<div class="avatar">${msg.sender === 'ai' ? 'ğŸ¤–' : 'ğŸ‘¤'}</div>`;
                    const content = `<div class="message-content"><p>${msg.text}</p></div>`;
                    
                    messageElement.innerHTML = avatar + content;
                    chatHistory.appendChild(messageElement);
                });
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }

            function addMessage(sender, text) {
                const currentChat = chats.find(chat => chat.id === currentChatId);
                if (currentChat) {
                    currentChat.messages.push({ sender, text });
                    saveChats();
                    renderChatHistory();
                }
            }

            function handleSendMessage() {
                const text = chatInput.value.trim();
                if (text) {
                    addMessage('user', text);
                    chatInput.value = '';
                    updateProcessButtonState();

                    // Simulate AI response
                    setTimeout(() => {
                        let aiResponse = "ì£„ì†¡í•©ë‹ˆë‹¤. ì•„ì§ í•´ë‹¹ ê¸°ëŠ¥ì€ ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤. ì™¼ìª½ì˜ 'ì˜ìƒ ì²˜ë¦¬ ì‹œì‘' ë²„íŠ¼ì„ ì´ìš©í•´ì£¼ì„¸ìš”.";
                        if (text.includes("ì²˜ë¦¬ ì‹œì‘") || text.includes("ë§Œë“¤ì–´ì¤˜")) {
                             aiResponse = "ë„¤, ì•Œê² ìŠµë‹ˆë‹¤. ì™¼ìª½ íŒ¨ë„ì˜ ì„¤ì •ì„ ê¸°ë°˜ìœ¼ë¡œ ì˜ìƒ ì²˜ë¦¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.";
                             processBtn.click();
                        }
                        addMessage('ai', aiResponse);
                    }, 1000);
                }
            }
            
            sendChatBtn.addEventListener('click', handleSendMessage);
            chatInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            });
             chatInput.addEventListener('input', updateProcessButtonState);

            // Chat Management
            function saveChats() {
                localStorage.setItem('autoshorts_chats', JSON.stringify(chats));
            }

            function loadChats() {
                const savedChats = localStorage.getItem('autoshorts_chats');
                if (savedChats) {
                    chats = JSON.parse(savedChats);
                    const lastChat = chats[chats.length - 1];
                    if (lastChat) {
                        currentChatId = lastChat.id;
                    } else {
                        startNewChat();
                    }
                } else {
                    startNewChat();
                }
                renderChatHistory();
            }

            function startNewChat() {
                const newChat = {
                    id: Date.now(),
                    messages: [
                        { sender: 'ai', text: 'ì•ˆë…•í•˜ì„¸ìš”! ìˆì¸  ì˜ìƒ ì œì‘ì„ ë„ì™€ë“œë¦´ AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤. ì™¼ìª½ì— ìˆëŠ” ì˜µì…˜ì„ ì„¤ì •í•˜ê³ , ì €ì—ê²Œ ì œì‘ì„ ìš”ì²­í•´ì£¼ì„¸ìš”.' }
                    ]
                };
                chats.push(newChat);
                currentChatId = newChat.id;
                saveChats();
                renderChatHistory();
            }

            newChatBtn.addEventListener('click', startNewChat);

            // --- Main Processing Logic ---
            processBtn.addEventListener('click', () => {
                if (processBtn.disabled) return;
                
                addMessage('ai', "ì˜ìƒ ì²˜ë¦¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...");

                completedShortsGrid.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">ì˜ìƒì„ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</p>';

                setTimeout(() => {
                    completedShortsGrid.innerHTML = '';
                    const shortsCount = parseInt(document.getElementById('shortsCount').value, 10) || 1;
                    const shortsLength = parseInt(document.getElementById('shortsLength').value, 10);
                    const originalVideo = document.getElementById('videoPreview');
                    const videoSrc = originalVideo.src;
                    const originalDuration = originalVideo.duration;

                    if (!videoSrc) {
                       addMessage('ai', 'ì˜¤ë¥˜: ì²˜ë¦¬í•  ì›ë³¸ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.');
                       completedShortsGrid.innerHTML = '<p style="text-align: center; color: var(--error-text);">ì˜¤ë¥˜: ì²˜ë¦¬í•  ì›ë³¸ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                       return;
                    }
                    
                    if (isNaN(originalDuration) || originalDuration < shortsLength) {
                        addMessage('ai', `ì˜¤ë¥˜: ì›ë³¸ ì˜ìƒì˜ ê¸¸ì´(${Math.round(originalDuration)}ì´ˆ)ê°€ ìš”ì²­ëœ ìˆì¸  ê¸¸ì´(${shortsLength}ì´ˆ)ë³´ë‹¤ ì§§ìŠµë‹ˆë‹¤.`);
                        completedShortsGrid.innerHTML = `<p style="text-align: center; color: var(--error-text);">ì˜¤ë¥˜: ì›ë³¸ ì˜ìƒì´ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤. ê¸¸ì´ë¥¼ ë‹¤ì‹œ ì„¤ì •í•´ì£¼ì„¸ìš”.</p>`;
                        return;
                    }

                    for(let i = 0; i < shortsCount; i++) {
                        const maxStartTime = originalDuration - shortsLength;
                        const startTime = Math.floor(Math.random() * maxStartTime);
                        const endTime = startTime + shortsLength;
                        const segmentSrc = `${videoSrc}#t=${startTime},${endTime}`;
                        
                        const newShort = document.createElement('div');
                        newShort.className = 'short-item';
                        newShort.innerHTML = `
                            <div class="video-container">
                                <video src="${segmentSrc}" muted loop></video>
                                <div class="video-overlay">â–¶</div>
                            </div>
                            <div class="short-info">
                                <span>Short #${i + 1} (${startTime}s~${endTime}s)</span>
                                <button class="download-btn">ë‹¤ìš´ë¡œë“œ</button>
                            </div>`;
                        completedShortsGrid.appendChild(newShort);
                    }
                    
                    document.querySelectorAll('.short-item .video-container').forEach(container => {
                        const video = container.querySelector('video');
                        if (video) {
                            container.addEventListener('mouseenter', () => video.play().catch(e=>console.log("Autoplay failed", e)));
                            container.addEventListener('mouseleave', () => video.pause());
                        }
                    });

                    addMessage('ai', `${shortsCount}ê°œì˜ ìˆì¸  ì˜ìƒì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ìœ„ì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”!`);

                }, 2000);
            });

            // --- Initial Setup ---
            loadChats();
            initializeMainModels();
            updateSubModels();
            updateProcessButtonState();
        });
    </script>
</body>
</html>